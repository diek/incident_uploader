<!-- partials/image_upload_form.html -->
<form
    hx-post="{% url 'upload_incident_image' incident.id %}"
    hx-target="#image-list"
    hx-swap="beforeend"
    hx-on::after-request="this.reset(); showPreview(event)"
    enctype="multipart/form-data"
    class="image-upload-form"
>
    {% csrf_token %}

    <div class="upload-field">
        <input
            type="file"
            name="image"
            accept="image/*"
            required
            onchange="previewImage(this)"
        >
        <img id="preview" style="max-width: 200px; display: none;">
    </div>

    <div class="caption-field">
        <input
            type="text"
            name="caption"
            placeholder="Caption (optional)"
            maxlength="255"
        >
    </div>

    <button type="submit">Upload Image</button>
</form>

<script>
function previewImage(input) {
    const preview = document.getElementById('preview');
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
